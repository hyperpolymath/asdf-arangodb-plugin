#!/usr/bin/env bash
# SPDX-License-Identifier: AGPL-3.0-or-later
set -euo pipefail
source "$(dirname "${BASH_SOURCE[0]}")/../lib/utils.bash"
check_dependencies
[[ -z "${ASDF_INSTALL_VERSION:-}" ]] && fail "ASDF_INSTALL_VERSION required"
[[ -z "${ASDF_INSTALL_PATH:-}" ]] && fail "ASDF_INSTALL_PATH required"
download_path="${ASDF_DOWNLOAD_PATH:-${ASDF_INSTALL_PATH}/tmp}"
[[ ! -d "${download_path}" ]] && { mkdir -p "${download_path}"; url="$(get_download_url "${ASDF_INSTALL_VERSION}")"; download_file "${url}" "${download_path}/arangodb.tar.gz"; tar -xzf "${download_path}/arangodb.tar.gz" -C "${download_path}" --strip-components=1; }
cp -r "${download_path}"/* "${ASDF_INSTALL_PATH}/" 2>/dev/null || mkdir -p "${ASDF_INSTALL_PATH}" && cp -r "${download_path}"/* "${ASDF_INSTALL_PATH}/"
chmod +x "${ASDF_INSTALL_PATH}/bin"/* 2>/dev/null || true
[[ -d "${ASDF_INSTALL_PATH}/tmp" ]] && rm -rf "${ASDF_INSTALL_PATH}/tmp"
log_info "ArangoDB ${ASDF_INSTALL_VERSION} installed"
